webpackJsonp([3],{"2fq4":function(n,t,r){var a=r("guJ9");"string"==typeof a&&(a=[[n.i,a,""]]),a.locals&&(n.exports=a.locals);r("rjj0")("00735e1a",a,!1,{})},"35vI":function(n,t){n.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAgCAYAAAAWl4iLAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAZdEVYdFNvZnR3YXJlAEFkb2JlIEltYWdlUmVhZHlxyWU8AAADKGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMwNjcgNzkuMTU3NzQ3LCAyMDE1LzAzLzMwLTIzOjQwOjQyICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNSAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo5RTI4RTE3OUMwRTIxMUU2ODczMkM3MEIyNDgxNzNDNCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo5RTI4RTE3QUMwRTIxMUU2ODczMkM3MEIyNDgxNzNDNCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjlFMjhFMTc3QzBFMjExRTY4NzMyQzcwQjI0ODE3M0M0IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjlFMjhFMTc4QzBFMjExRTY4NzMyQzcwQjI0ODE3M0M0Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+y8RRJwAAA15JREFUSEutlstPE1EUh39zp9OZTh8UAQHdoRQ1kY1uBYzRjStdyNqNC90pwURNjAtjNOofYOLGpRu3hmg0iIlGjYkxoviIIeGhbbWlnXaGaYvn3BZEOgNI+ZIh03PO/bhz7r3tKAsEfBj5UMTTTzbGZ+aRzFVkrC0qsLsziIEeA0f2hGTMC0/xndE53BjJwTQMhE0DwaCGgKrKXKlcxvy8C6tgo2DbGD4Sxam+mMwtp0588OYMUraGti1NUBQF8HsgyvHQ5K8sWg0XT4Y6a4kq/4h7r0whHI3BDJkkrD76migChWIBVm4O7y5vrwWXiQ/dnoVVMREOs9Rnln7Q7C2rgLAo4PHZDhkS/OfuWA4/rQAi4fD/Sxkaw2PZwS5Giq8/nEMr9XRhvY/vAY/ldWEXIx6NF6EbOoSghWoQhRzsekTbVPA+jZgb6KsX3BJyPZ2wIT7MuNC1QC3TOOxip0jly1ADstWbghpQwU5RkevVeH+Xw07RSme/XN74blgJu9gpEu0aXNethRuHXewU/QkD+WJRnp6GIQe7+rsNiKN7TeQse7N2m3Qd7TWrJ+/MQATpDJ0Y+kLZMDSWHafJxUjTucNNMGDDcWz6tJGWKHIsO4bIxSxNcex8JyZnM7SqJfr0P3JFjuGx7FhkSaypCl5daMfUbApuiXfJeuSKrJ36kZJj2bFI3S+I5VSw/+o02lpaoGkaRfxWlaS0tZLpNF5f3Iaw/u/61K0WF7y5tA2zyXStLd5wjmu4dqWUqY8QZlBgdLgD36dTntuQY5x7RjVc64V3lOiIBXDvZAsJkrTv/5bxPcc41041fviKmb5ECIP7QviV5T1OC0MX3w/uD8ncaqwqZq4db0bJsVCh9wm+XNvCtWPNtaw/a4qZm4PtSGVydFm4Nbi1Fl0dzzchJpX+jQw9tu04aDbKOH6/FZUFBQ9OJJFxVBi6jng8Rj/C3rOvE//OZDE+8Q1CFdACAWTncvj6eQJjmR65ow/EP6FrZwLxpigdjhK1p4LdiS40x6tHeZG6Vrz/+EW+q7FUDwYx9uItstY8duiT2BmclPfPX76VOa7hWh6zkjVnnMnm8PHzN+TzeZmPRCLY1d215ox9e8z/gNvgOC7KlTIdimoZvyiqQoWua2iKReuEVYA/CC+TbdZ+bt8AAAAASUVORK5CYII="},"6tyb":function(n,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("mvHQ"),e=r.n(a),i={name:"maps",data:function(){return{heights:document.documentElement.clientHeight-61+"px",list:[],level:13,initCenter:new BMap.Point(121.3056,31.204803),map:null,xgrids:[],ygrids:[],beSelectBounds:{},bounds:null,span:null,mapAyy:[],flag:!1,mapsd:{},mapdetail:"",address_detail:"",userlocation:{lng:"",lat:""}}},mounted:function(){var n=this;this.$axios.get(this.$api+"/map/map_data").then(function(t){n.mapdetail=t.data,console.log("shujv",n.mapdetail),n.Zmap()})},methods:{ceshi:function(){this.flag=!1},Zmap:function(){var n=this,t=this;this.map=new BMap.Map("map");var r=new BMap.Point(121.481976,31.226871);this.map.centerAndZoom(r,13);var a=new BMap.Marker(new BMap.Point(121.481976,31.226871));this.map.addOverlay(a),this.map.enableScrollWheelZoom(!0);for(var i=function(r){l={position:new BMap.Point(t.mapdetail[r].cen_loc.lng,t.mapdetail[r].cen_loc.lat),offset:new BMap.Size(-50,0)},(s=new BMap.Label(t.mapdetail[r].area_id+" 等级:"+t.mapdetail[r].level+" 系数:"+t.mapdetail[r].area_rate,l)).setStyle({color:"red",fontSize:"12px",height:"20px",lineHeight:"20px",fontFamily:"微软雅黑",width:"120px",display:""}),n.map.addOverlay(s),s.addEventListener("click",function(){t.$axios.post("map/get_w_j_count",{region_id:t.mapdetail[r].area_id}).then(function(n){console.log(t.mapsd=n.data),t.flag=!0})})},o=0;o<t.mapdetail.length;o++){var l,s;i(o)}for(var p=1;p<this.mapdetail.length;p++)if(this.mapdetail[p].active){var d=[new BMap.Point(this.mapdetail[p].locations.ld.lng,this.mapdetail[p].locations.ld.lat),new BMap.Point(this.mapdetail[p].locations.lt.lng,this.mapdetail[p].locations.lt.lat),new BMap.Point(this.mapdetail[p].locations.rt.lng,this.mapdetail[p].locations.rt.lat),new BMap.Point(this.mapdetail[p].locations.rd.lng,this.mapdetail[p].locations.rd.lat)],m=""+d[0].lng+d[0].lat+d[2].lng+d[2].lat,c=new BMap.Polygon(d,{strokeColor:"red",strokeWeight:2,strokeOpacity:.5});c.setFillColor("green"),this.map.addOverlay(c),this.beSelectBounds[m]=c}this.initProperty(),this.initGrid(),this.map.addEventListener("dragend",function(){t.initProperty(),t.initGrid()}),this.map.addEventListener("zoomend",function(){var n=t.map.getZoom();console.log(n),!(n<13);e()(t.mapAyy);t.initProperty(),t.initGrid()})},initProperty:function(){this.level=this.map.getZoom(),this.bounds={x1:this.map.getBounds().getSouthWest().lng,y1:this.map.getBounds().getSouthWest().lat,x2:this.map.getBounds().getNorthEast().lng,y2:this.map.getBounds().getNorthEast().lat},console.log(this.bounds),this.span=this.getSpan()},initGrid:function(){for(var n in this.xgrids)this.map.removeOverlay(this.xgrids[n]);for(var n in this.xgrids=[],this.ygrids)this.map.removeOverlay(this.ygrids[n]);this.ygrids=[];var t=this.span,r=this.getMaxMinLongitudeLatitude(121.481976,31.226871,6);console.log(r);for(n=this.bounds.x1+(this.initCenter.lng-this.bounds.x1)%t.x-t.x;n<this.bounds.x2+t.x;n+=t.x){var a=new BMap.Polyline([new BMap.Point(n.toFixed(6),this.bounds.y1),new BMap.Point(n.toFixed(6),this.bounds.y2)],{strokeColor:"black",strokeWeight:1,strokeOpacity:.5});this.xgrids.push(a),this.map.addOverlay(a)}for(n=this.bounds.y1+(this.initCenter.lat-this.bounds.y1)%t.y-t.y;n<this.bounds.y2+t.y;n+=t.y){a=new BMap.Polyline([new BMap.Point(this.bounds.x1,n.toFixed(6)),new BMap.Point(this.bounds.x2,n.toFixed(6))],{strokeColor:"black",strokeWeight:1,strokeOpacity:.5});this.ygrids.push(a),this.map.addOverlay(a)}console.log("网格数据",this.ygrids)},getSpan:function(){return{x:.0630974,y:.05395}},getGrid:function(n){var t=this,r=this.xgrids.map(function(n){return n.getPath()[0].lng}).filter(function(r){return Math.abs(r-n.lng)<=t.span.x}).sort(function(n,t){return n-t}).slice(0,2),a=this.ygrids.map(function(n){return n.getPath()[0].lat}).filter(function(r){return Math.abs(r-n.lat)<=t.span.y}).sort(function(n,t){return n-t}).slice(0,2);return[new BMap.Point(r[0],a[0]),new BMap.Point(r[0],a[1]),new BMap.Point(r[1],a[1]),new BMap.Point(r[1],a[0])]},reset:function(){this.map.reset()},getMaxMinLongitudeLatitude:function(n,t,r){console.log("MaxMinLongitudeLatitude",n,t);var a=6371.393,e=n,i=t,o=2*Math.asin(Math.sin(r/(2*a))/Math.cos(i*Math.PI/180));o=180*o/Math.PI;var l=r/a;return l=180*l/Math.PI,console.log(l,o),e-o+"-"+(e+o)+"-"+(i-l)+"-"+(i+l)},ZPoint:function(n,t,r){this.code=r,this.point=new BMap.Point(n,t)},fromtext:function(){var n,t=this,r=this;n=r.mapsd.active?1:0,this.$axios.post("map/change_status",{area_id:r.mapsd.region_id,active:n}).then(function(n){n.data.active?(r.flag=!1,t.$message({showClose:!0,message:"区域已开通"})):(r.flag=!1,t.$message({showClose:!0,message:"区域已关闭"}))})},qvxiao:function(){this.flag=!1}}},o=function(){var n=this,t=n.$createElement,r=n._self._c||t;return r("div",{staticClass:"boxs"},[r("el-form",{directives:[{name:"show",rawName:"v-show",value:n.flag,expression:"flag"}],ref:n.mapsd,staticClass:"from",attrs:{"label-width":"80px",model:n.mapsd}},[r("el-form-item",{attrs:{label:"区域ID"}},[r("el-input",{model:{value:n.mapsd.region_id,callback:function(t){n.$set(n.mapsd,"region_id",t)},expression:"mapsd.region_id"}})],1),n._v(" "),r("el-form-item",{attrs:{label:"技师人数"}},[r("el-input",{model:{value:n.mapsd.w_count,callback:function(t){n.$set(n.mapsd,"w_count",t)},expression:"mapsd.w_count"}})],1),n._v(" "),r("el-form-item",{attrs:{label:"会员人数"}},[r("el-input",{model:{value:n.mapsd.j_count,callback:function(t){n.$set(n.mapsd,"j_count",t)},expression:"mapsd.j_count"}})],1),n._v(" "),r("el-form-item",{attrs:{label:"是否开通"}},[r("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:n.mapsd.active,callback:function(t){n.$set(n.mapsd,"active",t)},expression:"mapsd.active"}})],1),n._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:n.fromtext}},[n._v("更新")]),n._v(" "),r("el-button",{on:{click:n.qvxiao}},[n._v("取消")])],1)],1),n._v(" "),r("div",{staticClass:"map",style:{height:n.heights},attrs:{id:"map"}})],1)};o._withStripped=!0;var l={render:o,staticRenderFns:[]},s=l;var p=!1;var d=r("VU/8")(i,s,!1,function(n){p||r("2fq4")},"data-v-4b3f9934",null);d.options.__file="src/components/map2.vue";var m={name:"map_list",components:{MapLists:d.exports}},c=function(){var n=this.$createElement,t=this._self._c||n;return t("div",[t("MapLists")],1)};c._withStripped=!0;var u={render:c,staticRenderFns:[]},g=u;var h=!1;var v=r("VU/8")(m,g,!1,function(n){h||r("dMT/")},"data-v-8047b548",null);v.options.__file="src/views/admin/strategy-map.vue";t.default=v.exports},"dMT/":function(n,t,r){var a=r("m9b4");"string"==typeof a&&(a=[[n.i,a,""]]),a.locals&&(n.exports=a.locals);r("rjj0")("e8472b10",a,!1,{})},guJ9:function(n,t,r){(n.exports=r("FZ+f")(!0)).push([n.i,'\n.boxs[data-v-4b3f9934] {\r\n  height: 100%;\n}\n.map[data-v-4b3f9934] {\r\n  width: 100%;\r\n  height: 750px;\r\n  overflow: hidden;\r\n  margin: 0px;\r\n  padding: 0px;\r\n  margin: 0;\r\n  font-family: "\\5FAE\\8F6F\\96C5\\9ED1";\n}\n.from[data-v-4b3f9934] {\r\n  width: 50%;\r\n  position: absolute;\r\n  margin: 60px auto;\r\n\r\n  left: 0;\r\n  right: 0;\r\n  z-index: 10;\r\n  background: white;\n}\r\n',"",{version:3,sources:["D:/my-vue-webpack/utc-vue-webpack/src/components/src/components/map2.vue"],names:[],mappings:";AA2bA;EACA,aAAA;CACA;AACA;EACA,YAAA;EACA,cAAA;EACA,iBAAA;EACA,YAAA;EACA,aAAA;EACA,UAAA;EACA,oCAAA;CACA;AACA;EACA,WAAA;EACA,mBAAA;EACA,kBAAA;;EAEA,QAAA;EACA,SAAA;EACA,YAAA;EACA,kBAAA;CACA",file:"map2.vue",sourcesContent:['<template>\r\n  <div class="boxs">\r\n    <el-form label-width="80px" :ref="mapsd" :model="mapsd" v-show="flag" class="from">\r\n      <el-form-item label="区域ID">\r\n        <el-input v-model="mapsd.region_id"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label="技师人数">\r\n        <el-input v-model="mapsd.w_count"></el-input>\r\n      </el-form-item>\r\n\r\n      <el-form-item label="会员人数">\r\n        <el-input v-model="mapsd.j_count"></el-input>\r\n      </el-form-item>\r\n      <el-form-item label="是否开通">\r\n        <el-switch v-model="mapsd.active" active-color="#13ce66" inactive-color="#ff4949"></el-switch>\r\n      </el-form-item>\r\n\r\n      <el-form-item>\r\n        <el-button type="primary" @click="fromtext">更新</el-button>\r\n        <el-button @click="qvxiao">取消</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n    <div id="map" class="map" :style="{height:heights}"></div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n// import mapdetail from "@/assets/map"\r\n\r\nexport default {\r\n  name: "maps",\r\n  data() {\r\n    return {\r\n      heights: document.documentElement.clientHeight - 61 + "px",\r\n      list: [],\r\n      level: 13, //地图级别\r\n      initCenter: new BMap.Point(121.3056, 31.204803),\r\n      map: null,\r\n      xgrids: [], //经线\r\n      ygrids: [], //纬线\r\n      beSelectBounds: {},\r\n      bounds: null, //当前地图的四个顶点\r\n      span: null, //当前网格的跨度\r\n      mapAyy: [],\r\n      flag: false,\r\n      mapsd: {},\r\n      mapdetail: "",\r\n      address_detail: "", //详细地址\r\n      userlocation: { lng: "", lat: "" }\r\n    };\r\n  },\r\n  mounted() {\r\n    var _that = this;\r\n    this.$axios.get(_that.$api + "/map/map_data").then(res => {\r\n      this.mapdetail = res.data;\r\n      console.log("shujv", this.mapdetail);\r\n      this.Zmap();\r\n    });\r\n  },\r\n  methods: {\r\n    ceshi() {\r\n      this.flag = false;\r\n    },\r\n    Zmap() {\r\n      var onoff2 = true;\r\n      let zmap = this;\r\n      var zMap = this;\r\n      this.map = new BMap.Map("map"); // 创建地图实例\r\n      // console.log(\'....\',this.map)\r\n      var point = new BMap.Point(121.481976, 31.226871); // 创建点坐标\r\n      this.map.centerAndZoom(point, 13); // 初始化地图，设置中心点坐标和地图级别\r\n\r\n      var marker = new BMap.Marker(new BMap.Point(121.481976, 31.226871)); // 创建标注\r\n      this.map.addOverlay(marker);\r\n      this.map.enableScrollWheelZoom(true);\r\n      for (let i = 0; i < zmap.mapdetail.length; i++) {\r\n        var opts = {\r\n          position: new BMap.Point(\r\n            zmap.mapdetail[i].cen_loc.lng,\r\n            zmap.mapdetail[i].cen_loc.lat\r\n          ), // 指定文本标注所在的地理位置\r\n          offset: new BMap.Size(-50, 0) //设置文本偏移量\r\n        };\r\n        var label = new BMap.Label(\r\n          zmap.mapdetail[i].area_id +\r\n            " 等级:" +\r\n            zmap.mapdetail[i].level +\r\n            " 系数:" +\r\n            zmap.mapdetail[i].area_rate,\r\n          opts\r\n        ); // 创建文本标注对象\r\n        label.setStyle({\r\n          color: "red",\r\n          fontSize: "12px",\r\n          height: "20px",\r\n          lineHeight: "20px",\r\n          fontFamily: "微软雅黑",\r\n          width: "120px",\r\n          display: ""\r\n        });\r\n        this.map.addOverlay(label);\r\n        label.addEventListener("click", function() {\r\n          // map.openInfoWindow(infoWindow,point);   //提示信息\r\n          zmap.$axios\r\n            .post("map/get_w_j_count", {\r\n              region_id: zmap.mapdetail[i].area_id\r\n            })\r\n            .then(res => {\r\n              console.log((zmap.mapsd = res.data));\r\n              zmap.flag = true;\r\n            });\r\n        });\r\n      }\r\n\r\n      //已开通区域\r\n      for (var i = 1; i < zMap.mapdetail.length; i++) {\r\n        if (zMap.mapdetail[i].active) {\r\n          var points = [\r\n            new BMap.Point(\r\n              zMap.mapdetail[i].locations.ld.lng,\r\n              zMap.mapdetail[i].locations.ld.lat\r\n            ),\r\n            new BMap.Point(\r\n              zMap.mapdetail[i].locations.lt.lng,\r\n              zMap.mapdetail[i].locations.lt.lat\r\n            ),\r\n            new BMap.Point(\r\n              zMap.mapdetail[i].locations.rt.lng,\r\n              zMap.mapdetail[i].locations.rt.lat\r\n            ),\r\n            new BMap.Point(\r\n              zMap.mapdetail[i].locations.rd.lng,\r\n              zMap.mapdetail[i].locations.rd.lat\r\n            )\r\n          ];\r\n          var key =\r\n            "" + points[0].lng + points[0].lat + points[2].lng + points[2].lat; //使用两个点的坐标作为key\r\n          var polygon = new BMap.Polygon(points, {\r\n            strokeColor: "red",\r\n            strokeWeight: 2,\r\n            strokeOpacity: 0.5\r\n          });\r\n          polygon.setFillColor("green");\r\n\r\n          zMap.map.addOverlay(polygon);\r\n          zMap.beSelectBounds[key] = polygon;\r\n        }\r\n      }\r\n      this.initProperty();\r\n      this.initGrid();\r\n\r\n      //添加移动后的点击事件\r\n      this.map.addEventListener("dragend", function() {\r\n        zmap.initProperty();\r\n        zmap.initGrid();\r\n      });\r\n      //添加放大或缩小时的事件\r\n\r\n      this.map.addEventListener("zoomend", function() {\r\n        var ZoomNum = zmap.map.getZoom();\r\n        console.log(ZoomNum);\r\n        if (ZoomNum < 13) {\r\n          onoff2 = false;\r\n        } else {\r\n          onoff2 = true;\r\n        }\r\n        var string = JSON.stringify(zmap.mapAyy);\r\n        // console.log(\'string\',string)\r\n        // console.log("数据",zmap.mapAyy)\r\n        zmap.initProperty();\r\n        zmap.initGrid();\r\n      });\r\n      //设置点击事件\r\n      // this.map.addEventListener("click", function(e) {\r\n      //   //zmap.mapsd = zmap.mapdetail[i];\r\n      //   //zmap.flag = true;\r\n      //   var lat = e.point.lat;\r\n      //   var lng = e.point.lng;\r\n      //   var point = { lat: lat, lng: lng };\r\n      //   //获取当前点是在哪个区块内,获取正方形的四个顶点\r\n      //   var points = zmap.getGrid(point);\r\n      //   console.log(points);\r\n      //   // console.log("0000",points)\r\n      //   //判断当前区域是否已经被选中过，如果被选中过则取消选中\r\n      //   var key =\r\n      //     "" + points[0].lng + points[0].lat + points[2].lng + points[2].lat; //使用两个点的坐标作为key\r\n      //   if (zmap.beSelectBounds[key]) {\r\n      //     this.map.removeOverlay(zmap.beSelectBounds[key]);\r\n      //     delete zmap.beSelectBounds[key];\r\n      //     return;\r\n      //   }\r\n      //   var polygon = new BMap.Polygon(points, {\r\n      //     strokeColor: "red",\r\n      //     strokeWeight: 2,\r\n      //     strokeOpacity: 0.5\r\n      //   });\r\n      //   polygon.setFillColor("red");\r\n      //   zmap.map.addOverlay(polygon);\r\n      //   zmap.beSelectBounds[key] = polygon;\r\n      // });\r\n\r\n      // var ac = new BMap.Autocomplete({\r\n      //   //建立一个自动完成的对象\r\n      //   input: "suggestId",\r\n      //   location: zmap.map\r\n      // });\r\n      // var myValue;\r\n      // ac.addEventListener("onconfirm", function(e) {\r\n      //   //鼠标点击下拉列表后的事件\r\n      //   var _value = e.item.value;\r\n      //   myValue =\r\n      //     _value.province +\r\n      //     _value.city +\r\n      //     _value.district +\r\n      //     _value.street +\r\n      //     _value.business;\r\n      //   zmap.address_detail = myValue;\r\n\r\n      //   setPlace();\r\n      // });\r\n\r\n      function setPlace() {\r\n        // zmap.map.clearOverlays();    //清除地图上所有覆盖物\r\n        function myFun() {\r\n          zmap.userlocation = local.getResults().getPoi(0).point; //获取第一个智能搜索的结果\r\n          console.log("poi", zmap.userlocation);\r\n          zmap.map.centerAndZoom(zmap.userlocation, 13);\r\n          var myIcon = new BMap.Icon(\r\n            require("../assets/images/marker.png"),\r\n            new BMap.Size(22, 32)\r\n          );\r\n          zmap.map.addOverlay(\r\n            new BMap.Marker(zmap.userlocation, { icon: myIcon })\r\n          ); //添加标注\r\n        }\r\n\r\n        // var local = new BMap.LocalSearch(zmap.map, {\r\n        //   //智能搜索\r\n        //   onSearchComplete: myFun\r\n        // });\r\n        // console.log("myvalue", myValue);\r\n        // local.search(myValue);\r\n\r\n        //测试输出坐标（指的是输入框最后确定地点的经纬度）\r\n        // zmap.map.addEventListener("click",function(e){\r\n        //   //经度\r\n        //   console.log(zmap.userlocation.lng);\r\n        //   //维度\r\n        //   console.log(zmap.userlocation.lat);\r\n        //\r\n        // })\r\n      }\r\n    },\r\n    initProperty: function() {\r\n      //初始化当前地图的状态\r\n      this.level = this.map.getZoom();\r\n      // console.log("map",this.map.getBounds().getSouthWest())\r\n      this.bounds = {\r\n        x1: this.map.getBounds().getSouthWest().lng,\r\n        y1: this.map.getBounds().getSouthWest().lat,\r\n        x2: this.map.getBounds().getNorthEast().lng,\r\n        y2: this.map.getBounds().getNorthEast().lat\r\n      };\r\n      console.log(this.bounds);\r\n      // console.log("boundes",this.bounds)\r\n      this.span = this.getSpan(); //需要使用level属性\r\n    },\r\n    initGrid: function() {\r\n      //初始化网格\r\n      var zMap = this;\r\n      //将原来的网格线先去掉\r\n      for (var i in zMap.xgrids) {\r\n        this.map.removeOverlay(zMap.xgrids[i]);\r\n      }\r\n      zMap.xgrids = [];\r\n      for (var i in zMap.ygrids) {\r\n        this.map.removeOverlay(zMap.ygrids[i]);\r\n      }\r\n      zMap.ygrids = [];\r\n      //获取当前网格跨度\r\n      var span = zMap.span;\r\n      //初始化地图上的网格\r\n      // console.log("网格数据",zMap.bounds.x1)\r\n      // console.log("zMap.initCenter",span)\r\n      //开通区域\r\n      var adbbsa = zMap.getMaxMinLongitudeLatitude(121.481976, 31.226871, 6);\r\n      console.log(adbbsa);\r\n      for (\r\n        var i =\r\n          zMap.bounds.x1 +\r\n          ((zMap.initCenter.lng - zMap.bounds.x1) % span.x) -\r\n          span.x;\r\n        i < zMap.bounds.x2 + span.x;\r\n        i += span.x\r\n      ) {\r\n        var polyline = new BMap.Polyline(\r\n          [\r\n            new BMap.Point(i.toFixed(6), zMap.bounds.y1),\r\n            new BMap.Point(i.toFixed(6), zMap.bounds.y2)\r\n          ],\r\n          { strokeColor: "black", strokeWeight: 1, strokeOpacity: 0.5 }\r\n        );\r\n        zMap.xgrids.push(polyline);\r\n        zMap.map.addOverlay(polyline);\r\n      }\r\n      for (\r\n        var i =\r\n          zMap.bounds.y1 +\r\n          ((zMap.initCenter.lat - zMap.bounds.y1) % span.y) -\r\n          span.y;\r\n        i < zMap.bounds.y2 + span.y;\r\n        i += span.y\r\n      ) {\r\n        var polyline = new BMap.Polyline(\r\n          [\r\n            new BMap.Point(zMap.bounds.x1, i.toFixed(6)),\r\n            new BMap.Point(zMap.bounds.x2, i.toFixed(6))\r\n          ],\r\n          { strokeColor: "black", strokeWeight: 1, strokeOpacity: 0.5 }\r\n        );\r\n        zMap.ygrids.push(polyline);\r\n        zMap.map.addOverlay(polyline);\r\n      }\r\n\r\n      console.log("网格数据", zMap.ygrids);\r\n    },\r\n    getSpan: function() {\r\n      //获取网格的跨度\r\n      var scale = 0.75;\r\n      // var x = 0.00064;\r\n      // for (var i = this.level; i < 19; i++) {\r\n      //     x *= 2;\r\n      // }\r\n      //  var y = parseFloat((scale * x).toFixed(6));\r\n      //  console.log(x,y)\r\n      var y = 0.05395;\r\n      var x = 0.0630974;\r\n      return { x: x, y: y };\r\n    },\r\n    getGrid: function(point) {\r\n      //返回当前点在所在区块的四个顶点\r\n      var zMap = this;\r\n      //先找出两条纵线坐标\r\n      var xpoints = this.xgrids\r\n        .map(function(polyline) {\r\n          return polyline.getPath()[0].lng;\r\n        })\r\n        .filter(function(lng) {\r\n          return Math.abs(lng - point.lng) <= zMap.span.x;\r\n        })\r\n        .sort(function(a, b) {\r\n          return a - b;\r\n        })\r\n        .slice(0, 2);\r\n\r\n      //再找出两条横线的坐标\r\n      var ypoints = this.ygrids\r\n        .map(function(polyline) {\r\n          return polyline.getPath()[0].lat;\r\n        })\r\n        .filter(function(lat) {\r\n          return Math.abs(lat - point.lat) <= zMap.span.y;\r\n        })\r\n        .sort(function(a, b) {\r\n          return a - b;\r\n        })\r\n        .slice(0, 2);\r\n\r\n      //\tthis.map.centerAndZoom(new BMap.Point(xpoints[0], ypoints[0]), zMap.level);\r\n      // console.log("00011总",new BMap.Point(xpoints[0], ypoints[0]))\r\n      // console.log("00011",new BMap.Point(xpoints[0]+0.0262, ypoints[0]+0.02246))\r\n      return [\r\n        new BMap.Point(xpoints[0], ypoints[0]),\r\n        new BMap.Point(xpoints[0], ypoints[1]),\r\n        new BMap.Point(xpoints[1], ypoints[1]),\r\n        new BMap.Point(xpoints[1], ypoints[0])\r\n      ];\r\n    },\r\n    reset: function() {\r\n      //重置\r\n      this.map.reset();\r\n    },\r\n    getMaxMinLongitudeLatitude(longitude, latitude, distince) {\r\n      console.log("MaxMinLongitudeLatitude", longitude, latitude);\r\n      let r = 6371.393; // 地球半径千米\r\n      let lng = longitude;\r\n      let lat = latitude;\r\n      let dlng =\r\n        2 *\r\n        Math.asin(\r\n          Math.sin(distince / (2 * r)) / Math.cos((lat * Math.PI) / 180)\r\n        );\r\n      dlng = (dlng * 180) / Math.PI; // 角度转为弧度\r\n      let dlat = distince / r;\r\n      dlat = (dlat * 180) / Math.PI;\r\n      console.log(dlat, dlng);\r\n      let minlat = lat - dlat;\r\n      let maxlat = lat + dlat;\r\n      let minlng = lng - dlng;\r\n      let maxlng = lng + dlng;\r\n      return minlng + "-" + maxlng + "-" + minlat + "-" + maxlat;\r\n    },\r\n    ZPoint: function(x, y, code) {\r\n      this.code = code;\r\n      this.point = new BMap.Point(x, y);\r\n    },\r\n    fromtext() {\r\n      let that = this;\r\n      var onoff;\r\n      if (that.mapsd.active) {\r\n        onoff = 1;\r\n      } else {\r\n        onoff = 0;\r\n      }\r\n      this.$axios\r\n        .post("map/change_status", {\r\n          area_id: that.mapsd.region_id,\r\n          active: onoff\r\n        })\r\n        .then(res => {\r\n          if (res.data.active) {\r\n            that.flag = false;\r\n            this.$message({\r\n              showClose: true,\r\n              message: "区域已开通"\r\n            });\r\n          } else {\r\n            that.flag = false;\r\n            this.$message({\r\n              showClose: true,\r\n              message: "区域已关闭"\r\n            });\r\n          }\r\n        });\r\n    },\r\n    qvxiao() {\r\n      this.flag = false;\r\n    }\r\n  }\r\n};\r\n<\/script>\r\n\r\n<style scoped>\r\n.boxs {\r\n  height: 100%;\r\n}\r\n.map {\r\n  width: 100%;\r\n  height: 750px;\r\n  overflow: hidden;\r\n  margin: 0px;\r\n  padding: 0px;\r\n  margin: 0;\r\n  font-family: "微软雅黑";\r\n}\r\n.from {\r\n  width: 50%;\r\n  position: absolute;\r\n  margin: 60px auto;\r\n\r\n  left: 0;\r\n  right: 0;\r\n  z-index: 10;\r\n  background: white;\r\n}\r\n</style>\r\n'],sourceRoot:""}])},m9b4:function(n,t,r){(n.exports=r("FZ+f")(!0)).push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","",{version:3,sources:[],names:[],mappings:"",file:"strategy-map.vue",sourceRoot:""}])},mvHQ:function(n,t,r){n.exports={default:r("qkKv"),__esModule:!0}},qkKv:function(n,t,r){var a=r("FeBl"),e=a.JSON||(a.JSON={stringify:JSON.stringify});n.exports=function(n){return e.stringify.apply(e,arguments)}}});
//# sourceMappingURL=3.80fcec4289bae122c686.js.map